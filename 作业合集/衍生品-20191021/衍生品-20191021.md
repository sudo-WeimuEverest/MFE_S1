课程名称：《衍生工具模型》
提交日期：2019年10月21日
姓名：胡庆涛
学号：1901210003



#### 作业题1

> 证明 $E[S(t_{0})exp((\mu_{1}-\frac{\sigma_{1}^2}{2})(T-t_{0})+\sigma_{1}(B_{1}(T)-B_{1}(t_{0})))|\mathbb{F_{0}}]=e^{\mu_{1}(T-t_{0})}S(t_{0})$

原式 = $S(t_{0})e^{(\mu_{1}-\frac{\sigma_{1}^2}{2})(T-t_{0})}E(e^{\sigma_{1}(B_{1}(T)-B_{1}(t_{0}))}|\mathbb{F_{0}})$

由布朗运动性质可知， $B(T)-B(t_{0}) \sim N(\mu_{1}(T-t_{0}), \sigma_{1}^2(T-t_{0}))$, 且与 $\mathbb{F_{0}}$独立

故有，$E(e^{\sigma_{1}(B_{1}(T)-B_{1}(t_{0}))}|\mathbb{F_{0}})= e^{\frac{\sigma_{1}^2}{2}(T-t_{0})}$

因此， 原式 = $S(t_{0})e^{\mu_{1}(T-t_{0})}$

#### 作业题2

在$0$ 时刻构造投资组合： $\Pi(0)= v(S,0,E,T) - \Delta S_{0} $ , $v \in (c,p)$

由无套利假定知， $t$ 时刻该组合的收益率为无风险收益率
$$
\begin{align}
dV_t -\Delta t dS_t= r \Pi_tdt+ \Delta t S_tqdt\\
\end{align}
$$
又因 $dV_t =  (\mu S \frac{\partial v}{\partial S} + \frac{\partial v}{\partial t}  + \frac{\sigma^2}{2} S^2 \frac{\partial^2 v}{\partial S^2} )dt+ \sigma S \frac{\partial v}{\partial S}d B_t$, 故有

$ (\mu S \frac{\partial v}{\partial S} + \frac{\partial v}{\partial t}  + \frac{\sigma^2}{2} S^2 \frac{\partial^2 v}{\partial S^2} )dt+ (\sigma S \frac{\partial v}{\partial S}-\Delta t \sigma S)d B_t -\Delta t \mu S dt= r(V_t -\Delta t S_t)dt +q \Delta t S_tdt $

故， $dB_t$ 的系数为零， $\Delta _t = \frac{\partial v}{\partial S}$，代入原式可得：
$$
\frac{\partial v}{\partial t}  + \frac{\sigma^2}{2} S^2 \frac{\partial^2 v}{\partial S^2} +(r-q)S \frac{\partial v}{\partial S} - rv =0
$$

#### 作业题3

易知，风险中性测度下，连续股息派发时， 有 $S_{T}= S_{t} e^{(r-q-\frac{\sigma ^2}{2})(T-t)+ \sigma (B^{Q}(T)- B^{Q}(t))}$, 则有 $ln S_{T}= lnS_{t} + (r-q-\frac{\sigma ^2}{2})(T-t)+ \sigma (B^{Q}(T)- B^{Q}(t))$ 。 而$  B^{Q}(T)- B^{Q}(t)$ 可记为 $y \sqrt{T-t}$， 其中 $y \sim N(0,1)$。 故$lnS_{T} \sim N(lnS_{t} + (r-q-\frac{\sigma ^2}{2})(T-t)), \sigma^2 (T-t)$

定义 $g(S_{T})$ 为 $S_T$  的概率密度函数， 则有 $\mathbb{E}^{Q}[max(S_{T}-E, 0)|F_t]= \int_{E}^{\infin}(S_T-E)g(S_T)dS_T$

而 $lnS_T$ 服从正态分布， 记其标准差为 $\omega$ , 均值为 $m$, 将其进行标准化， 记 $Q= \frac{lnS_T-m}{\omega} \sim N(0,1)$
$$
\begin{align}
\mathbb{E}^{Q}[max(S_{T}-E, 0)|F_t] & = \int_{(lnE-m)/ \omega} ^{\infin} (e^{Q \omega +m}- E ) h(Q)dQ \quad （记h（Q）= \frac{1}{\sqrt{2 \pi}}e^{-\frac{Q^2}{2}})\\
& = \underbrace {e^{(m+\omega)/ 2}\int_{(lnE-m)/ \omega} ^{\infin}h(Q-\omega)dQ}_{(1)} - \underbrace{E \int_{(lnE-m)/ \omega} ^{\infin}h(Q)dQ}_{(2)}
\end{align}
$$
记 $N(x)$ 表示标准正态分布变量小于 $x$ 的概率， 则： 
$$
\begin{align}
(1) &= N(\frac{(ln \frac{S}{E}+ (r-q+\frac{\sigma ^2}{2})(T-t)}{\sigma \sqrt{T-t}})= N(d_1)\\
(2) &= N(\frac{(ln \frac{S}{E}+ (r-q-\frac{\sigma ^2}{2})(T-t)}{\sigma \sqrt{T-t}})=N(d_2)
\end{align}
$$
因而：
$$
\begin{align}
c(S,t,E,T) & = e^{-r(T-t)}\mathbb{E}^{Q}[max(S_{T}-E, 0)|F_t]\\
& = e^{-r(T-t)}(S e^{(r-q)(T-t)}N(d_1)+ E N(d_2))\\
& = e^{-q(T-t)}S N(d_1)- e^{-r(T-t)}EN(d_2)
\end{align}
$$

由连续股息派发情形下的$put-call \quad parity$ 得：$c(S,t,E,T)+e^{-r(T-t)}E  = p(S,t,E,T)+ e^{-q(T-t)}S(t)$
$$
\begin{align}
p(S,t,E,T)&= c(S,t,E,T)+e^{-r(T-t)}E-e^{-q(T-t)}S(t)\\
& =e^{-q(T-t)}S(t) N(d_1)- e^{-r(T-t)}EN(d_2)-+e^{-r(T-t)}E-e^{-q(T-t)}S(t)\\
& = -S(t)e^{-q(T-t)}N(-d_{1})+e^{-r(T-t)}EN(d_{2})
\end{align}
$$

#### 作业题4

1、对于 $S_T$分布的讨论可沿用作业题3，即 $lnS_{T} \sim N(lnS_{t} + (r-q-\frac{\sigma ^2}{2})(T-t)), \sigma^2 (T-t)$， 定义 $g(S_{T})$ 为 $S_T$  的概率密度函数， 则对于$c^d(S,t,E,T)$有 $\mathbb{E}^{Q}[f(S_T|F_t]= \int_{E}^{\infin}g(S_T)dS_T$

而 $lnS_T$ 服从正态分布， 记其标准差为 $\omega$ , 均值为 $m$, 将其进行标准化， 即 $Q= \frac{lnS_T-m}{\omega} \sim N(0,1)$, 记 $h(Q)$ 为标准正态分布的概率密度函数 
$$
\begin{align}
\mathbb{E}^{Q}[f(S_T|F_t]&= \int_{(lnE-m)/ \omega} ^{\infin}h(Q)dQ \\
& = N(\frac{(ln \frac{S}{E}+ (r-q-\frac{\sigma ^2}{2})(T-t)}{\sigma \sqrt{T-t}})\\
& =N(d_2)
\end{align}
$$
故， $c^d(S,t,E,T)= e^{-r(T-t)}\mathbb{E}^{Q}[f(S_T|F_t]= e^{-r(T-t)}N(d_2)$

2、符号记号同上，$\mathbb{E}^{Q}[f(S_T|F_t]=\int_{E}^{\infin}S_T g(S_T)dS_T $， 计算如下：
$$
\begin{align}
\mathbb{E}^{Q}[f(S_T|F_t]&= \int_{(lnE-m)/ \omega} ^{\infin}e^{Q \omega + m }h(Q)dQ \\
& =e^{(m+\omega)/ 2}\int_{(lnE-m)/ \omega} ^{\infin}h(Q-\omega)dQ\\
& =S e^{(r-q)(T-t)}N(\frac{(ln \frac{S}{E}+ (r-q+\frac{\sigma ^2}{2})(T-t)}{\sigma \sqrt{T-t}})\\
& = S e^{(r-q)(T-t)}N(d_1)
\end{align}
$$
故， $c^{a/n}(S,t,E,T)= e^{-r(T-t)}\mathbb{E}^{Q}[f(S_T|F_t]= S e^{(r-q)(T-t)}N(d_1) $

由上述两题计算可见： $c(S,t,E,T)= c^{a/n}(S,t,E,T)- Ec^d(S,t,E,T)$

#### 作业题5

$T \rightarrow \infin $时， $d_1，d_2 \rightarrow \infin$

由期权的定价公式可知， $\lim\limits_{T \rightarrow \infin} c(S,t,E,T)=S(t); \lim\limits_{T \rightarrow \infin} c(S,t,E,T)= 0$

对于该极限的理解：当到期日趋向于无穷大时，可理解为看跌期权永远不会被执行，或者说，就算期权被执行，那以无限大的时间折现到当下时刻，价值也该为零。而看涨期权必定执行，相当于在 $t$ 时刻买入一股股票。

#### 作业题6

- 方差互换，可将其视为一个 $t=0$ 签订的远期合约，区间内无现金流，$T$ 时刻 A 从B方获得现金 $\frac{1}{N} \sum_{i=0}^{N-1}(\frac{S_{i+1}-S_{i}}{S_{i}})^2-E$, 而 $E$ 对应远期合约的价格。该合约也是可以用来对冲波动率变大带来的风险。通过计算得到表达式如下：
  $$
  E_{var}= \frac{2e^{rT}}{T}(\int_{0}^{F_0}\frac{p(S,0,E,T)}{E^2}dE+\int_{F_0}^{\infin}\frac{c(S,0,E,T)}{E^2}dE)
  $$
  该公式也说明，我们用一系列欧式看涨期权和看跌期权，每个期权的权重和它的执行价格平方成反比，就能复制一份方差互换，另外值得一提，$variance \quad swap$ 的 $gamma$ 值为常数。

- 而中国波指（上证$50ETF$波动率指数）就是基于方差互换原理，采用上证$50ETF$期权相关数据计算得到。其近月（剩余到期天数超过7天的最近到期合约）波动率具体表达式如下：
  $$
  \sigma^2 = \underbrace{\frac{2}{T}\sum_{i}\frac{\Delta K_{i}}{K_{i}^2}e^{RT}P(K_i)}_{(1)}-\underbrace{\frac{1}{T}[\frac{F}{K_0}-1]^2}_{(2)}
  $$
  其中，$ K_0$ 为小于 $F$ 且最接近的执行价格；

   $\Delta K_i = 0.5(K_{i+1}-K_{i-1})$; 

  $P(K_i)$： 若 $K_i< K_0$, 为 $K_i$ 对应认沽期权的价格，  若 $K_i> K_0$, 为 $K_i$ 对应认购期权的价格，若 $K_i=  K_0$, 为 $K_i$ 对应认沽期权与认购期权的平均价格；

  $S$：认购期权价格与认沽期权价格相差最小的执行价

  $F: S + e^{RT} \times [认购期权价格(S)-认沽期权价格(S)]$ （即对应远期的价格）

  $R$: 上交所采用的利率（可以参考一年期国债利率、一年期 $Shibor$ 利率或者一年期存贷款基准利率等 ）

  （可见，(1)为原式的积分和近似式，（2）为 $\frac{2}{T}[ln \frac{F}{K_0}-(\frac{F}{K_0}-1)]$ 的近似）

- 下面计算波动率的值时，采用表达式$E_{var}= \frac{2}{T}\sum\limits_{i}\frac{\Delta K_{i}}{K_{i}^2}e^{RT}P(K_i) $进行近似计算，取 $F = Se^{RT}$, 其他符号定义同上。示例代码如下：

  ```c++
  #include<iostream>
  #include<cmath>
  #include<fstream>
  #include<vector>
  using namespace std;
  
  #define R 0.02651 // 使用对应的一年期国债利率2.651
  #define S 3.059 //数据导出时对应的上证50ETF价格
  #define T 36.0/365.0  //11月合约的到期日
  #define e 2.718281828459045 //自然底数
  #define N 11 //价格数据的数目
  
  int main (){
      double F = S*pow(e,R*T); //简易思路求得远期价格
      //分别输入看涨期权、看跌期权和行权价的价格
      vector<double> call{0.311,0.2606,0.2142,0.1689,0.1278,0.0929,0.042,0.015,0.0054,0.0022,0.0013};
      vector<double> put{0.002,0.0032,0.0056,0.0105,0.0193,0.0334,0.0819,0.1557,0.2457,0.3419,0.4409};
      vector<double> K{2.75,2.8,2.85,2.9,2.95,3,3.1,3.2,3.3,3.4,3.5};
      
      //找到K0,即小于F且最接近的执行价格
      int min = abs(call[0]-F);
      int r =0;
      for(int i =0; i< N; ++i){
          if ( abs(i - F) < min){
              min = abs(call[i]-F);
              r = i;
          }
      }
      double K0 = K[r];
      
      //求表达式中第一项和式的值
      double sum = 0;
      for(int i =0;i < N;++i){
          double P = 0; //对应表达式中的P（Ki）
          double Delta =0;
          if (K[i]< K0){
              P = call[i];}
          else if (K[i]> K0){
              P = put[i];
          }
          else{
              P = (put[i]+call[i])/2;
          }
          if (i=1){
              Delta = K[1] - K[0];}
          else if (i=N-1){
              Delta = K[N-1] - K[N-2];
          }
          else{
              Delta = 0.5*(K[i+1]-K[i-1]);
          }
          sum += (Delta/K[i]*K[i])*pow(e,R*T)*P;
      }
      //计算表达式
      double variance = (2/double(T))*sum;
      cout << variance <<endl;
  }
  ```

  针对11月合约的计算结果为：$0.63229$， 代入其他数据，并修改相应参数即可得到其他时点计算的波动率，其他结果为：$0.76853、0.65726、0.59023$。