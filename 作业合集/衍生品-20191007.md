课程名称：《衍生工具模型》
提交日期：2019年10月7日
姓名：胡庆涛
学号：1901210003

### 作业题 1 

> 用无套利假定证明命题 4.2
>
> （1）假设股票 $S$ 仅在 $t_{d} \in(t, T)$ 派发一次股息，其派发额为 $D>0$， 则
> $$
> S(t)-D e^{-r\left(t_{d}-t\right)}-E \leq \mathbb{C}(S, t, E, T)-\mathbb{P}(S, t, E, T) \leq S(t)-e^{-r(T-t)} E
> $$
> （2）假设股票 $S$ 连续股息派发，其派发率为 $q\geq0$, 证明：
> $$
> e^{-q(T-t)} S(t)-E \leq \mathbb{C}(S, t, E, T)-\mathbb{P}(S, t, E, T) \leq S(t)-e^{-r(T-t)} E
> $$



首先可证，$c(S,t,E,T) \leq \mathbb{C}(S,t,E,T); p(S, t, E, T) \leq \mathbb{P}(S, t, E, T) $  (证明可见作业题 6)，下文使用 $P_t(A)$ 表示组合 $A$ 在 $t$ 时刻的价值

**（1）单次股利派发情形**

- 对于 $S(t)-D e^{-r\left(t_{d}-t\right)}-E\leq\mathbb{C}(S, t, E, T)-\mathbb{P}(S, t, E, T) $

  -> $t$ 时刻构造两个投资组合，价值如下：
  $$
  \begin{cases}
  A:& c(S,t,E,T)+De^{-r(t_{d}-t)}+ E\\
  B:& \mathbb{P}(S, t, E, T)+S(t)
  \end{cases}
  $$
  -> $t_{0}$时刻 ，假设看跌期权被执行

  ​	若 $t < t_{0} < t_{d} < T$, 两个投资组合价值变为：

  ​	$\begin{cases}
  A:& c(S,t_{0},E,T)+De^{r(t_{0}-t_{d})}+Ee^{r(t_{0}-t)}\\
  B:& E 
  \end{cases}$ 显然有$P_{t_{0}}(A)> P_{t_{0}}(B)$

  ​	若$t < t_{d} \leq t_{0} < T$，两个投资组合价值变为：

  ​	$\begin{cases}
  A:& c(S,t_{0},E,T)+De^{r(t_{0}-t_{d})}+Ee^{r(t_{0}-t)}\\
  B:& E + De^{r(t_{0}-t{d})}
  \end{cases}$ 显然有$P_{t_{0}}(A)> P_{t_{0}}(B)$

  -> $T$ 时刻，假设两个投资组合都一直被持有，组合价值为：

  $\begin{cases}
  A:& max(S(T)-E,0)+De^{r(T-t_{d})}+Ee^{r(T-t)}=max(S(T),E)+De^{r(T-t_{d})}+E(e^{r(T-t)}-1)\\
  B:& max(E-S(T),0)+S(T)+De^{r(T-t{d})}=max(S(T),E)+De^{r(T-t_{d})}
  \end{cases}$

  ​	显然有 $P_{T}(A)\geq P_{T}(B)$, $E =0$ 时，二者相等

  综上所述， $t_{i} \in (t,T)$ 时，都有 $P_{t_{i}}(A)\geq P_{t_{i}}(B)$。 故由无套利假定，可知 $P_{t}(A)\geq P_{t}(B)$, 即
  $$
  c(S,t,E,T)+De^{-r(t_{d}-t)}+ E \geq \mathbb{P}(S, t, E, T)+S(t)
  $$
  又因：$c(S,t,E,T) \leq \mathbb{C}(S,t,E,T) $，原不等式得证。

- 对于 $\mathbb{C}(S, t, E, T)-\mathbb{P}(S, t, E, T) \leq S(t)-e^{-r(T-t)} E$

  -> $t$ 时刻构造两个投资组合，价值如下：
  $$
  \begin{cases}
  C:& \mathbb{C}(S, t, E, T)+e^{-r(T-t)} E \\
  D:& S(t) + p(S,t,E,T)
  \end{cases}
  $$
  -> $t_{0}$ 时刻，假设美式看涨期权被执行

  ​	若 $t< t_{0} < t_{d} < T$, 两个投资组合价值变为：

  ​	$\begin{cases}
  C:& S(t_{0})+(e^{-r(T-t)}-1）E < S(t_{0})\\
  D:& S(t_{0})+ p(S,t,E,T)
  \end{cases}$ 显然有$P_{t_{0}}(C)< P_{t_{0}}(D)$

  ​	若$t< t_{d} \leq t_{0} < T$，两个投资组合价值变为：

  ​	$\begin{cases}
  C:& S(t_{0})+(e^{-r(T-t)}-1）E\\
  D:& S(t_{0})+De^{r(t_{0}-t{d})}+p(S,t,E,T)
  \end{cases}$ 显然有$P_{t_{0}}(C)<  P_{t_{0}}(D)$

  -> $T$ 时刻，假设两个投资组合都一直被持有，组合价值为：

  ​	$\begin{cases}
  C:& max(S(T)-E,0)+E=max(S(T),E)\\
  D:& S(T)+De^{q(T-t_{d})}+max(E-S(T),0)=max(S(T),E)++De^{q(T-t_{d})}
  \end{cases}$

  ​	显然有， $P_{T}(C) < P_{T}(D)$

  综上所述， $t_{i} \in (t,T)$ 时，都有 $P_{t_{i}}(C)\leq P_{t_{i}}(D)$。 故由无套利假定，可知 $P_{t}(C)\leq P_{t}(D)$, 即
  $$
  \mathbb{C}(S, t, E, T)+e^{-r(T-t)} E \leq S(t)+p(S, t, E, T)
  $$
  又因：$p(S, t, E, T) \leq \mathbb{P}(S, t, E, T)$, 原不等式得证。

**（2）连续股利派发情形**

- 对于$e^{-q(T-t)} S(t)-E \leq \mathbb{C}(S, t, E, T)-\mathbb{P}(S, t, E, T)$

  -> $t$ 时刻构造两个投资组合，价值如下：
  $$
  \begin{cases}A:& c(S,t,E,T)+E\\B:& \mathbb{P}(S, t, E, T)+e^{-q(T-t)}S(t)\end{cases}
  $$
  -> $t_{0}$时刻 ( $t< t_{0}< T$)，假设看跌期权被执行，两个投资组合价值变为：

  ​	$\begin{cases}
  A:& c(S,t_{0},E,T)+Ee^{r(t_{0}-t)}\\
  B:& E+ S(t_{0})(e^{-q(T-t_{0})}-1)<E
  \end{cases}$  显然有$P_{t_{0}}(A)> P_{t_{0}}(B)$

  -> $T$ 时刻，假设两个投资组合都一直被持有，组合价值为：

  ​	$\begin{cases}
  A:& max(S(T)-E,0)++Ee^{r(T-t)}=max(S(T),E)+E(e^{r(T-t)}-1)\\
  B:& max(E-S(T),0)+S(T)=max(S(T),E)
  \end{cases}$

  ​	显然有 $P_{T}(A)\geq P_{T}(B)$, $E =0$时，二者相等

  综上所述， $t_{i} \in (t,T)$ 时，都有 $P_{t_{i}}(A)\geq P_{t_{i}}(B)$。 故由无套利假定，可知 $P_{t}(A)\geq P_{t}(B)$, 即
  $$
  c(S,t,E,T)+E \geq\mathbb{P}(S, t, E, T)+e^{-q(T-t)}S(t)
  $$
  又因：$c(S,t,E,T) \leq \mathbb{C}(S,t,E,T) $，原不等式得证。

- 对于 $\mathbb{C}(S, t, E, T)-\mathbb{P}(S, t, E, T) \leq S(t)-e^{-r(T-t)} E$

  -> $t$ 时刻构造两个投资组合，价值如下：
  $$
  \begin{cases}
  C:& \mathbb{C}(S, t, E, T)+e^{-r(T-t)} E \\
  D:& S(t) + p(S,t,E,T)
  \end{cases}
  $$
  -> $t_{0}$ 时刻（ $t< t_{0} < T$），假设美式看涨期权被执行，两个投资组合价值变为：

  ​	$\begin{cases}
  C:& S(t_{0})+(e^{-r(T-t)}-1）E < S(t_{0})\\
  D:& S(t_{0})e^{q(t_{0}-t)}+ p(S,t,E,T)
  \end{cases}$  显然有$P_{t_{0}}(C)< P_{t_{0}}(D)$

  -> $T$ 时刻，假设两个投资组合都一直被持有，组合价值为：

  ​	$\begin{cases}
  C:& max(S(T)-E,0)+E=max(S(T),E)\\
  D:& S(T)e^{q(T-t)}+max(E-S(T),0)=max(S(T),E)+S(T)(e^{q(T-t)}-1)
  \end{cases}$

  ​	显然有， $P_{T}(C) < P_{T}(D)$

  综上所述， $t_{i} \in (t,T)$ 时，都有 $P_{t_{i}}(C)\leq P_{t_{i}}(D)$。 故由无套利假定，可知 $P_{t}(C)\leq P_{t}(D)$, 即
  $$
  \mathbb{C}(S, t, E, T)+e^{-r(T-t)} E \leq S(t)+p(S, t, E, T)
  $$
  又因：$p(S, t, E, T) \leq \mathbb{P}(S, t, E, T)$, 原不等式得证。

### 作业题 2

> 用无套利假定证明：
> $$
> \mathbb{C}(S, t, E, T) \geq \max (S(t)-E, 0) 
> $$
> 和
> $$
> \mathbb{P}(S, t, E, T) \geq \max (E-S(t), 0)
> $$



1. 若 $S(t)< E$， $\mathbb{C}(S,t,E,T)\geq 0$ 自然应当成立。

   故探讨 $S(t)> E$ 情境下, 如果 $\mathbb{C}(S,t,E,T) < S(t)-E$，有

   $t$ 时刻初始资金为零。卖空一股 $S$ , 买入一份美式看涨期权，则可在该时刻立即执行，以现金$E$ 购得一股 $S$ 得以偿还股票，剩余无风险套利 $S(t)-E- \mathbb{C}(S,t,E,T)$

2. 若 $E<S(t)$，$\mathbb{P}(S,t,E,T)\geq0$ 自然应当成立。

   故探讨 $E>S(t)$ 情境下，如果 $\mathbb{P}(S,t,E,T)< E-S(t)$，有

   $t$ 时刻初始资金为零。借入现金 $E$，购得一股 $S$, 买入一份美式看跌期权，并且在该时刻立即执行，以现金 $E$ 将 $S$ 卖出以偿还贷款，剩余无风险套利 $E-S(t)-\mathbb{P}(S,r,E,T)$

   故由无套利假定，原式得证。

### 作业题 3

> 假设：$S$ 无股息派发，在 $t$ 时， $S(t)<H$, 其中 $H$ 时给定正常数， 考虑一张没有到期日，标的为 $S$ 的衍生证券 $v$ ，如果在 $t$ 以后的某个时刻 $\tau$，首次有等式 $S(\tau)=H$，那么 $v$ 的持有者获得 $1$ 元现金，之后合约作废。 问：在 $t$ 时刻，$v$ 等于多少？

$t$ 时刻，建立投资组合：买入$\frac{1}{H}S(t)$ ,卖出一份 $v$。 若 $S(T) =0$, 组合价值为 $0$。 若 $0<S(t)<H$, 则衍生证券不会被执行， 若 $S(T)=H$, 卖出 $S$, 刚好获得 1 元现金，用于执行衍生证券 $v$， 执行后价值为 0。故由无套利假定知，初始投资也为零，即 $v = \frac{S(t)}{H}$



### 作业题 4

> 给定连续股息派发股票 $S$，其股息派发率为非负常数 $q$。记 $F(S,t,T)$ 为标的为 $S$， $T$ 时到期的期货合约，$c_{F}(F,t,E,T)$ 和 $p_{F}(F,t,E,T)$ 分别记为标的为 $F$，敲定价为 $E$，$T$ 时刻到期的欧式看涨和看跌期权
>
> 1. 证明： $c_{F}(F, t, E, T)-p_{F}(F, t, E, T)=e^{-r(T-t)}(F(S, t, T)-E)$
> 2. 假设在 $t$ 时， 股票 $S$ 和它的期货 $F(S,t,T)$ 都涨停板。此时你无法买入该股票和期货 $F$。但是，在期权市场无涨跌停板的限制，交易者可以在任何时候买卖任意敲定价，到期日为 $T$ 的欧式看涨期权 $c_{F}$ 和欧式看跌期权 $p_{F}$，构造投资策略：通过买卖一些期权 $c_{F}$ 和/或 $p_{F}$ 和/或向银行存/贷款，使得该策略等同于买入 $1$ 份期货合约 $F$，并说明理由。



1. 由期货的性质可知，期货型欧式看涨期权在 $T$ 时刻的价值为：$max(F(S,t,T)-E,0)$，看跌期权的为 $max(E-F(S,t,T),0)$，下将 $F(S,t,T)$ 简写为 $F$
   $$
   max(F,E)= max(E,F)\\
   max(F-E,0)+E=max(E-F,0)+F\\
   max(F-E,0)e^{-r(T-t)}-max(E-F,e^{-r(T-t)})=(F-Ee^{-r(T-t)})\\
   c_{F}(F, t, E, T)-p_{F}(F, t, E, T)=e^{-r(T-t)}(F(S, t, T)-E)
   $$

2. 平价公式蕴含着不同种类产品之间的复制思想。

   由上述证明可得，$F(S,t,T)= e^{r(T-t)}[c_{F}(F,t,E,T)-p_{F}(F,t,E,T)]+ E$

   故可以通过该式复制一份期货合约，即买入 $e^{r(T-t)}$份期权 $c_F$,卖出 $e^{r(T-t)}$ 份期权 $p_{F}$, 向银行存款 $E$。

### 作业题 5

> 生成股票的100条路径

使用 $Monte Carlo Simulation$，假设股价服从几何布朗运动，其价格变化可表示为：
$$
\frac{\Delta S}{S}=\underbrace{\mu \Delta t}_{drift}+ \underbrace{\sigma \epsilon\sqrt{\Delta t}}_{shock}
$$
生成路径代码如下：

```C++
#include <iostream>
#include <cmath>
#include <random>
#include <fstream>
using namespace std;

//运用Box-Muller方法生成正态分布的随机数
double GetOneGaussianByBoxMuller()
{
	double result;

	double x;
	double y;

	double sizeSquared;
	do
	{
		x = 2.0 * rand() / static_cast<double>(RAND_MAX) - 1;
		y = 2.0 * rand() / static_cast<double>(RAND_MAX) - 1;
		sizeSquared = x * x + y * y;
	} while
		(sizeSquared >= 1.0);
	result = x * sqrt(-2 * log(sizeSquared) / sizeSquared);

	return result;
}

//Monte Carlo模拟生成股价路径
double StockMC(
    double Spot,
    double Expiry,
    double Mu,
    double Sigma,
    unsigned long NumberOfPaths){
    
    double dt = 1/Expiry; //定义时间间隔
    double drift = Mu * dt; //初始化漂移项； 
    double shock;
    
    char filename[1314];
    //循环生成100条路经
    for(unsigned long number = 1; number <= NumberOfPaths; number++){
        double price = Spot; //每条路径初始价格统一
        srand(number); //每次生成随机数使用不同的种子
		
        //实现数字与字符的转换
        sprintf(filename,"C:\\Users\\Lenovo\\Desktop\\price\\%ld.txt",number); 
        ofstream fout(filename); //数据分路径储存在txt文件中
        //循环生成一条[0，T]的价格路径
        for (unsigned long i = 0; i <= Expiry; i++){
            fout << price << endl;
            //使用BoxMuller算法生成N（0，1）的随机数
            double thisGaussian = GetOneGaussianByBoxMuller(); 
            shock = Mu * dt +  Sigma * Sigma * dt *  thisGaussian; //计算随机扰动项
            price = price + price * (shock + drift); //生成价格序列
        }
        fout.close();
    } 
}

int main(){
    double Spot;
    double Expiry;
    double Mu;
    double Sigma;
    unsigned long NumberOfPaths;
    
	cout << "\nEnter spot\n";
	cin >> Spot;

    cout << "\nEnter expiry\n";
	cin >> Expiry;
	
    cout << "\nEnter Mu\n";
	cin >> Mu;

    cout << "\nEnter Sigma\n";
	cin >> Sigma;

	cout << "\nNumber of paths\n";
	cin >> NumberOfPaths;
    
    StockMC(
        Spot,
        Expiry,
        Mu,
        Sigma,
        NumberOfPaths);
} 
```

使用python画图，代码如下：

```python
import matplotlib.pyplot as plt
import numpy as np
from scipy.stats import t

if __name__ == '__main__':
    for i in range(1,101): #此处range右限需对应改为NumberOfPaths+1
        #filename = C:/Users/Lenovo/Desktop//price/.txt
        with open('C:/Users/Lenovo/Desktop/price/'+str(i)+'.txt','r') as f: #读取储存的数据
            data =[]
            for line in f:
                data.append(float(line.strip()))  
        plt.yticks([])
        plt.plot(data) #分别将路径绘制到图中
    plt.savefig('C:/Users/Lenovo/Desktop/stock.jpg')
    exit(0)
```

将各输入值输入为：$Spot = 10; Expiry = 250; Mu =1; Sigma = 5; NumberOfPaths  = 100 $ ，得到路径如下图所示：

![stock](C:\Users\Lenovo\Desktop\stock.jpg)

### 作业题 6 

> 命题 3.1
> $$
> \begin{array}{c}{S(t) \geq \mathbb{C}(S, t, E, T) \geq c(S, t, E, T) \geq \max \left(e^{-q(T-t)} S(t)-e^{-r(T-t)} E, 0\right)} \\ {S(t)=\mathbb{C}(S, t, 0, T), \quad c(S, t, 0, T)=e^{-q(T-t)} S(t)} \\ {E \geq \mathbb{P}(S, t, E, T) \geq p(S, t, E, T) \geq \max \left(e^{-r(T-t)} E-e^{-q(T-t)} S(t), 0\right)}\end{array}
> $$
> 命题 3.2 对于无股息派发的股票 $S$，有
> $$
> \mathbb{C}(S, t, E, T)=c(S, t, E, T)
> $$



1、对于$S(t) \underbrace{\geq}_{(1)} \mathbb{C}(S, t, E, T) \underbrace{\geq}_{(2)} c(S, t, E, T) \underbrace{\geq}_{(3)} \max \left(e^{-q(T-t)} S(t)-e^{-r(T-t)} E, 0\right)$

(1)：若 $S(t) < \mathbb{C}(S, t, E, T)$

- 初始资金为零，卖出一份美式期权，买入一股 $S$ 构造组合，余 $\mathbb{C}-S(t)$ 元，存入银行。
- 假设 $t_{0}$ 时刻期权买方行权，行权后，获得无风险套利 $E+(\mathbb{C}-S(t))e^{r(t_{0}-t)}$，故 $(1)$ 式得证。
-  而当 $\mathbb{C}(S, t, 0, T) =S(t)$ 时，确保取等号也无套利机会。

(2)：若 $ \mathbb{C}(S, t, E, T) < c(S, t, E, T)$, 直观理解，美式期权与欧式期权除是否可提前行权，其他条件都相同，故价格应大于欧式期权。

- $t$ 时刻初始资金为零，卖出一份欧式期权，买入一份美式期权。余$c(S, t, E, T)-\mathbb{C}(S, t, E, T)$ 存入银行，记作 $b$
- $T$ 时刻，两份期权同时执行，获得资金 $E$ 给美式期权卖方，获得$S$ 给欧式期权买方。
- 获得无风险套利 $be^{r(T-t)}$

(3)：若 $c(S, t, E, T) < \max \left(e^{-q(T-t)} S(t)-e^{-r(T-t)} E, 0\right)$, 不妨假设 $max > 0$证明：$c(S, t, E, T) < e^{-q(T-t)} S(t)-e^{-r(T-t)} E$ 

- 初始资金为零，卖空 $e^{-q(T-t)}$ 股 $S$, 买入一份欧式期权。为 $T$ 时刻行权，留 $e^{-r(T-t)} E$ 备用存入银行，余 $e^{-q(T-t)}-c(S, t, E, T)-e^{-r(T-t)} E$, 记作 $b$ 

- 在 $T$ 时刻，用 $E$ 执行欧式期权，获得一股 $S$ ,刚好偿还借入的股票。获得无风险套利 $be^r(T-t)$
- 而当 $c(S,t,0,T)=e^{-q(T-t)}S(t)$ 时，确保等号也无套利机会

2、对于 $E \underbrace{\geq}_{(1)} \mathbb{P}(S, t, E, T) \underbrace{\geq}_{(2)} p(S, t, E, T) \underbrace{\geq}_{(3)} \max \left(e^{-r(T-t)} E-e^{-q(T-t)} S(t), 0\right)$

(1)：若 $E < \mathbb{P}(S, t, E, T)$, $t$ 时刻卖出一份美式看跌期权，则在对方行权的任意时刻，都能以价格 $E$ 买入一份股票，并且有剩余资金存入银行获得无风险套利。、

(2)：若 $\mathbb{P}(S, t, E, T) < p(S, t, E, T)$ ,类比看跌期权，美式期权能够选择是否提前行权，价格更高，构造方式也可类比，$T$ 时刻同时执行，可获得无风险套利。

(3)：若 $p(S, t, E, T) < \max \left(e^{-r(T-t)} E-e^{-q(T-t)} S(t), 0\right)$, 不妨假设 $max>0$ 证明： $p(S, t, E, T)< e^{-r(T-t)} E-e^{-q(T-t)}S(t)$

- 初始资金为零，$t$ 时刻借入 $e^{-r(T-t)} E$， 买入一份欧式看跌期权，并且买入 $e^{-q(T-t)}$ 股 $S$，剩余资金 $b=e^{-r(T-t)} E-e^{-q(T-t)}S(t)-p(S, t, E, T)$ 存入银行。

- 在 $T$ 时刻，以价格 $E$ 卖出持有的 $S$ (此时价格刚好为一股)，合约完成。并且偿还 $t$ 时刻的借款，获得无风险套利 $be^{r(T-t)} $