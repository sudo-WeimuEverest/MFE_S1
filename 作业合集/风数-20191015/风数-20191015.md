课程名称：《风险管理的数学方法》
提交日期：2019年10月15日
姓名：胡庆涛
学号：1901210003

### 1、VaR计算总结

记 $R_{i}$ 为资产 $i$ 的收益率，$\omega_{i}$ 为其权重，$W$ 为总投资头寸，$x_{i}$ 为资产 $i$ 的头寸金额

- **组合VaR**
  $$
  R_{p} = \sum_{i=1}^{N}\omega_{i}R_{i}\\
  \sigma_{p}^2= \omega'\Sigma \omega = \sum_{i=1}^{N}\omega_{i}\sigma{i}^2+ 2 \sum_{i,j}\omega_{i}\omega_{j}\sigma{ij}\\
  VaR_{P}=\alpha \sigma_{p} W = \alpha \sqrt{x'\Sigma x}\\
  VaR_{i} = \alpha \sigma_{i} |W_{i}|=\alpha \sigma_{i} |\omega_{i}| W
  $$

- **边际VaR**

  > 直观理解：衡量某项资产对组合风险的影响

  $$
  \Delta VaR_{i}=\frac{\partial VaR}{\partial x_{i}}=\frac{\partial VaR}{\partial w_{i}W}=\alpha\frac{\partial \sigma_{p}}{\partial\omega_{i}}=\alpha \frac{\operatorname{cov}\left(R_{i}, R_{p}\right)}{\sigma_{p}}
  $$

  又因 $\beta _{i}= \frac{cov(R_{i},R_{p})}{\sigma_{p}^2} $, 故有 $\Delta VaR_{i}=\alpha  \frac{\operatorname{cov}\left(R_{i}, R_{p}\right)}{\sigma_{p}}= \alpha (\beta_{i} \sigma_{P})= (\alpha \sigma_{p})\beta_{i}=\frac{VaR}{W}\beta_{i}$ 

  该表达式很直观，$\beta_{i}$ 用来衡量个体风险相对于整体组合的波动

- **成分VaR**

  > 直观理解：体现分散化效果的VaR加成分解法 $CVaR_{i}= \Delta VaR_{i} x_{i}$

  $$
  \begin{align}
  CVaR_{i}&= \Delta VaR_{i} x_{i}\\
  & = \Delta VaR_{i}\omega_{i}W\\
  & = \frac{VaR}{W}\beta_{i}\omega_{i}W\\
  & = VaR\omega_{i} \beta_{i} 
  \end{align}
  $$

  值得指出， $\sum_{i=1}^{N}\omega_{i}\beta_{i}=1$(这可以理解为投资组合的$ \beta $) ，自然有 $\sum_{i=1}^{N}CVaR_{i}=VaR$。
  
  又有 $\omega_{i} \beta_{i}= \omega_{i} \frac{cov(R_{i},R_{p})}{\sigma_{p}^2}= \frac{cov(\omega_{i} \beta_{i},R_{p})}{\sigma_{p}^2}$， 其代表成分 $i$ 对组合 $VaR$ 的贡献率。
  
  再由 $\beta_{i} =\frac{\sum \omega}{\omega' \sum \omega}=\rho_{ip} \frac{\sigma_{i}}{\sigma_{p}}$， 对于成分 $VaR$ 有， 
  $$
  CVaR_{i} = VaR \omega_{i} \beta_{i} = (\alpha \sigma_{p} W) \omega_{i}\rho_{ip} \frac{\sigma_{i}}{\sigma_{p}}= (\alpha W \omega_{i} \sigma_{i})\rho_{i}= VaR_{i} \rho_{ip}
  $$

- **增量VaR**

  > 直观理解：衡量某一项交易计划对投资组合的整体影响

  完全增量： $VaR_{p+a}- VaR_{p}$

  线性近似增量：$VaR_{p+a}$泰勒展开后忽略二次及更高项 -> $增量VaR= (\Delta VaR_{i})'a$

### 2、主成分分析

使用Stata来进行主成分分析，数据选取10只股票的对数收益率，分别为：贵州茅台、华兰生物、复星医药、万科A、招商银行、宁沪高速、中国平安、新城控股、春秋航空、福成股份。股票历史时间选取 "2018-09-01 ~ 2019-09-01 "，采用日收盘价，数据共241条。

Stata主成分分析的do文件如下：

```
*导入数据
import excel C:\Users\Lenovo\Desktop\stocks.xlsx, firstrow clear

*定义变量的标签
label var r1 "贵州茅台"
label var r2 "华兰生物"
label var r3 "复兴医药"
label var r4 "万科A"
label var r5 "招商银行"
label var r6 "宁沪高速"
label var r7 "中国平安"
label var r8 "新城控股"
label var r9 "春秋航空"
label var r10 "福成股份"

pca r1-r10 /*主成分分析*/
```

较为简单，直接得出主成分分析的结果如下图：

![1570953118931](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\1570953118931.png)

如图，虽然累计贡献率在第五主成分才达到82%，但第一主成分的贡献率较之其他更大一些，2-5主成分没有表现出较大的差异。载荷旋转后，前六个主成分对应的向量分别如下图：

![1570955806730](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\1570955806730.png)

可见，第一个主成分中，各支股票的系数均为正，该向量或许可以理解为市场的影响

### 3、分布的逼近思路

> 主要分解思路：设定阀值 $u(u < x)$, 阀值以下部分可依据经验分布的思路进行近似，超过阀值部分的分布则使用GPD来进行近似，目的在于更详细刻画尾部情形的同时，不过分耗费计算量

引入以下定义：$X_{1}、X_{2}...X_{n}$ 为 $iid$ 序列，$N_{u}$ 为超过 $u$ 的个数， $F_{u}(y) = P(X-u \leq y|X>u) $, 其生存函数 $\overline{F_{u}(y)} \sim \overline{G_{\epsilon ,\beta}}(x)= (1+\frac{\epsilon x}{\beta})^{-1 / \epsilon }, x \in (\epsilon, \beta) $
$$
\begin{align}
F(x) & = P(X \leq x)\\
& = P(X \leq x, X \leq u)+ P(X \leq x, X \geq u)\\
& = P(X \leq u )+ P(X>u)P(X-u \leq x-u|X>u)\\
& = F(u)+ (1-F(u))F_{u}(x-u)\\
& \sim (1-\frac{N_u}{n})+\frac{N_{u}}{n}\overline{G_{\epsilon ,\beta}}(x-u)
\end{align}
$$
 而要求 $VaR_{p}$ , 即令 $F(x)=p$ 求解 $x$ 的值，故有
$$
\begin{align}
p &= (1-\frac{N_u}{n})+\frac{N_{u}}{n}\overline{G_{\epsilon ,\beta}}(x-u)\\
& = (1-\frac{N_u}{n})+\frac{N_{u}}{n} (1+\frac{\epsilon (x-u)}{\beta})^{-1 / \epsilon }\\
\\
(p-1+\frac{N_{u}}{n})\frac{n}{N_{u}}&= 1- (1+\frac{\epsilon (x-u)}{\beta})^{-1 / \epsilon }\\
(1-p)\frac{n}{N_u} &=  (1+\frac{\epsilon (x-u)}{\beta})^{-1 / \epsilon }\\
((1-p)\frac{n}{N_{u}})^{-\epsilon}& = 1+\frac{\epsilon}{\beta}(x-u)\\
\\
故有， VaR_{p} = x &\sim u+ \frac{\beta}{\epsilon}((\frac{n}{N_{u}}(1-p)^{-\epsilon}-1)

\end{align}
$$

